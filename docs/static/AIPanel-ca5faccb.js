import{i as Q,a as M,A as X,B as q,z as G,D as H}from"./index-19ae1788.js";import{R as e,r as n}from"./react-2c2ad9dc.js";import{o as V}from"./mobx-react-7d4c1e4f.js";import{x as Y,a2 as Z,B as i,R as ee,u as te,aX as $,aY as oe,a as T,aE as ne,aZ as ae,w as re,a_ as se}from"./@mui-fd8f6c35.js";import"./react-dom-c6aabcbc.js";import"./@babel-e5f941c7.js";import"./scheduler-765c72db.js";import"./monaco-editor-5cf1114e.js";/* empty css                      */import"./markdown-it-6b60e067.js";import"./mdurl-d7fdfec3.js";import"./uc.micro-78e30319.js";import"./entities-52510f6e.js";import"./linkify-it-7ae06500.js";import"./punycode.js-c41da3d1.js";import"./i18next-c75e253c.js";import"./react-i18next-65ca089e.js";import"./clsx-0839fdbe.js";import"./@monaco-editor-80ea4237.js";import"./state-local-dd516420.js";import"./react-resizable-942463f8.js";import"./react-draggable-966ae795.js";import"./prop-types-d9a440a1.js";import"./i18next-browser-languagedetector-ac00b891.js";import"./@emotion-ac376cc0.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./stylis-79144faa.js";import"./react-transition-group-34e06d3e.js";import"./@popperjs-61ffd834.js";import"./mobx-3741033e.js";import"./mobx-react-lite-afa2ccc5.js";import"./use-sync-external-store-b06bb362.js";const N="409f1e38b0d8586919166aa6117243f7.AVQTIQqUbGI1g8B5",le="https://open.bigmodel.cn/api/paas/v4/chat/completions";class ie{static token=N;async askAI(c,f,s,r,p,d){const B=()=>d?[{type:"image_url",image_url:{url:d}},{type:"text",text:c}]:c,v={model:d?"glm-4v-plus-0111":"glm-4-flash",tool:"web-search-pro",stream:!0,messages:[{role:"system",content:"你是一个专门为markdown写作输出内容的AI助手，严禁废话，若用户问换行符号怎么写，你的回答只需要：<br>"},{role:"system",content:"你作为一个markdownAI助手，只需要回答markdown格式纯文本即可，不要用markdown代码包裹回答，除非用户主动要求"},{role:"system",content:"所有数学/公式/定律/方程必须遵循:行内公式用单$包裹，公式块用两个$$包裹！严谨直接打印出来"},{role:"system",content:"用户问你思维导图/饼图等mermaid的语法图怎么写，你需要回答正确语法的mermaid内容，如```mermaid \n graph TD;\nA[人工智能学习思维导图] --> B[基础知识];\nB --> B1[数学基础];```"},{role:"system",content:f??`用户鼠标选中了这一段文本：${f}可能需要修改，扩写等对这段文本操作，你只需要回答修改后的文本即可`},{role:"user",content:B()}]};try{const l=await fetch(le,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`${N}`},body:JSON.stringify(v)});if(!l.body)throw new Error("ReadableStream not supported in this browser.");const I=l.body.getReader(),m=new TextDecoder("utf-8");let R=!1,g="";for(;!R;){const{value:S,done:h}=await I.read();if(R=h,S){const x=m.decode(S,{stream:!0}).split(`
`).filter(a=>a.trim()!=="");for(const a of x)if(a.startsWith("data:")){const b=a.replace("data:","").trim();if(b==="[DONE]"){r(g);return}try{const w=JSON.parse(b).choices[0].delta?.content;w&&(g+=w,s(w))}catch(y){console.error("JSON parse error:",y),p(y)}}}}}catch(l){console.error("Error:",l),p(l)}}}const ce=new ie,O=(await Q("https://cdn.jsdmirror.com/npm/gsap@3.12/+esm")).gsap,j=".prompt-panel-content",k=e.memo(Y("button")(({theme:P})=>({background:"none",border:"none",cursor:"pointer",padding:0,"&:hover":{backgroundColor:M()==="light"?"rgba(238, 238, 238, 0.9)":"rgba(66, 165, 245, 0.9)",borderColor:"#0062cc",transition:"background-color 0.4s ease-in-out, opacity 0.4s ease-in-out"},transition:"background-color 0.4s ease-in-out, opacity 0.4s ease-in-out",color:M()==="light"?"black":"white",height:"6svh",fontSize:"0.83rem",borderRadius:"55px",display:"flex",alignItems:"center",justifyContent:"center"}))),Ue=V(function(c){const f={posx:window.document.body.clientWidth/4,posy:window.document.body.clientHeight/2.5},s=n.useRef(null),r=n.useRef(null),p=n.useRef(null),[d,B]=n.useState(!1),[v,l]=n.useState(!1),[I,m]=n.useState(""),[R,g]=n.useState(!1),[S,h]=n.useState(!1),[C,x]=n.useState(""),a=n.useRef(null);e.useEffect(()=>{r.current&&setTimeout(()=>{r.current.focus()},100),B(c.open),c.open?O.fromTo(j,{x:0},{x:20,opacity:1,duration:.6}):O.to(j,{opacity:0,duration:.4,onComplete:()=>{}})},[c.open]);const b=()=>{H({unmemorable:{aiPanelState:!1}})},y=t=>{s.current&&!s.current.contains(t.target)&&b()},W=t=>{s.current&&!s.current.contains(t.target)&&(b(),t.preventDefault())},w=t=>{t.ctrlKey&&t.key==="Enter"&&(F(),r.current.value="")},z=t=>{if(t.clipboardData&&t.clipboardData.items)for(let o=0;o<t.clipboardData.items.length;o++){const u=t.clipboardData.items[o];if(u.type.indexOf("image")!==-1){const E=u.getAsFile();if(E){const A=new FileReader;A.onload=D=>{const K=D.target?.result;x(K)},A.readAsDataURL(E)}}}},L=()=>{a.current?.click()},U=t=>{const o=t.target.files;if(o&&o.length>0){const u=o[0],E=new FileReader;E.onload=A=>{const D=A.target?.result;x(D)},E.readAsDataURL(u)}},F=()=>{const t=r.current.value;t&&(l(!0),m(""),h(!0),g(!1),ce.askAI(t,q(),o=>{p.current&&p.current.scrollTo(0,1e4),m(u=>u+o),h(!1)},o=>{m(o),g(!0)},o=>{console.error("AI 请求错误:",o),m("抱歉，发生了错误，可能是宿主没充钱，请联系他olderonion@gmail.com :("),h(!1)},C),r.current.value="",_())},_=()=>{a.current&&(a.current.value=""),x("")},J=()=>{G(I,!1)};return e.createElement(e.Fragment,null,e.createElement(Z,{invisible:!0,transitionDuration:{appear:500,enter:500,exit:1e3},sx:{zIndex:t=>t.zIndex.drawer+1,pointerEvents:d?"auto":"none"},open:d,onContextMenu:W,onMouseUp:y},e.createElement(i,{ref:s,className:"prompt-panel-content",onClick:t=>{t.preventDefault(),t.stopPropagation()},sx:{width:"50svw",position:"absolute",display:"flex",flexDirection:"column",top:f.posy-window.document.body.clientHeight*.1,left:f.posx-window.document.body.clientWidth*.02,borderRadius:"25px",boxShadow:"7px 6px 12px 7px rgb(0 0 0 / 21%)",backgroundColor:M()==="light"?"white":"#333"}},v?e.createElement(e.Fragment,null,e.createElement(i,{sx:{padding:"21px 2vw 4px 16px"}},e.createElement(X,{ref:p,sx:{height:"20svh",width:"48svw"}},e.createElement(ee,{variant:"body1",gutterBottom:!0,sx:{whiteSpace:"pre-wrap"}},S?"AI 正在思考中...":I))),e.createElement(te,null)):null,e.createElement(i,{className:"FLEX COW",sx:{alignItems:"flex-end"}},e.createElement(i,{sx:{padding:"21px 6px 4px 16px",ml:1,flex:"0 0 89%"}},e.createElement($,{autoFocus:!0,multiline:!0,className:"transparent-scrollbar",onKeyDown:w,onPaste:z,fullWidth:!0,inputRef:r,maxRows:5,placeholder:"Search in GLM-4 AI Model",inputProps:{"aria-label":"search google maps"}})),e.createElement(i,null,e.createElement(k,{style:{padding:"0px 20px",fontWeight:"700"},onClick:F,"aria-label":"发送"},e.createElement(oe,null)))),e.createElement(i,{className:"FLEX COW"},e.createElement(T,{title:"Ctrl+J"},e.createElement(k,{style:{padding:"0px 20px",fontWeight:"700"}},e.createElement(ne,null)," Ask AI")),e.createElement(T,{title:"选择图片"},e.createElement(k,{onClick:L,"aria-label":"选择图片",style:{padding:"0px 20px",fontWeight:"700"}},e.createElement(ae,null))),e.createElement($,{multiline:!0,disabled:!0,fullWidth:!0,sx:{ml:1,flex:1},maxRows:5,placeholder:"Press Ctrl + Enter To Send",inputProps:{"aria-label":"search google maps"}}),C&&e.createElement(i,{sx:{ml:1,position:"relative",display:"inline-block"}},e.createElement("img",{src:C,alt:"图片预览",style:{width:35,height:35,borderRadius:"1px",objectFit:"cover"}}),e.createElement(k,{onClick:()=>_(),"aria-label":"删除图片",style:{position:"absolute",top:-8,right:-8,backgroundColor:"rgba(255,255,255,0.8)",borderRadius:"50%",width:20,height:20,padding:0,zIndex:1}},e.createElement(re,{style:{fontSize:16}}))),e.createElement(T,{title:"接受AI并插入编辑器"},e.createElement(k,{onClick:J,"aria-label":"插入",disabled:!R,style:{padding:"0px 20px",fontWeight:"700"}},e.createElement(se,null)))))),e.createElement("input",{type:"file",accept:"image/*",ref:a,style:{display:"none"},onChange:U}))});export{Ue as default};
