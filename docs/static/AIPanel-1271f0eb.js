import{a as e,r}from"./react-35b44ade.js";import{o as Q}from"./mobx-react-ba460afe.js";import{g as $}from"./gsap-cf87e9ff.js";import{x as X,a2 as q,B as l,R as G,u as H,aX as N,aY as V,a as T,aE as Y,aZ as Z,w as ee,a_ as te}from"./@mui-74c6dac0.js";import{a as W,w as oe,x as re,y as ne,z as ae}from"./index-fe7020eb.js";import"./@babel-a8d57c6d.js";import"./mobx-890d6d9e.js";import"./mobx-react-lite-b4a93dc6.js";import"./react-dom-a9366def.js";import"./scheduler-765c72db.js";import"./use-sync-external-store-5a80fce3.js";import"./clsx-d930028c.js";import"./@emotion-37ac9dfb.js";import"./hoist-non-react-statics-3f8ebaa8.js";import"./stylis-79144faa.js";import"./react-transition-group-6b117f63.js";import"./@popperjs-61ffd834.js";import"./prop-types-9cd9978a.js";import"./react-is-11039b32.js";import"./mermaid-25af2048.js";import"./dayjs-52a2a022.js";import"./@braintree-f19cff0e.js";import"./d3-transition-dcb2c4ce.js";import"./d3-dispatch-4199cc96.js";import"./d3-timer-8bbb3adf.js";import"./d3-interpolate-23596b47.js";import"./d3-color-568b2243.js";import"./d3-selection-de98f9a2.js";import"./d3-ease-6a302484.js";import"./d3-zoom-a2c53521.js";import"./dompurify-68816782.js";import"./dagre-d3-es-57771b5d.js";import"./lodash-es-82f45aac.js";import"./d3-shape-c15df95d.js";import"./d3-path-41c4cb36.js";import"./d3-fetch-5dc2c9dc.js";import"./khroma-dc7cc5cc.js";import"./uuid-55471c42.js";import"./d3-scale-20fecb82.js";import"./internmap-7949acc8.js";import"./d3-array-58f6faf7.js";import"./d3-format-ffdb8652.js";import"./d3-time-format-0d1ca8ac.js";import"./d3-time-ff8162d9.js";import"./d3-axis-8d489beb.js";import"./elkjs-af0ec365.js";import"./cytoscape-b0e0a780.js";import"./cytoscape-cose-bilkent-bcaac8aa.js";import"./cose-base-097e4f8d.js";import"./layout-base-6b6bf2ba.js";import"./d3-sankey-15198533.js";import"./d3-scale-chromatic-1b767f5e.js";import"./ts-dedent-356e4a49.js";import"./mdast-util-from-markdown-32388d6f.js";import"./micromark-24282579.js";import"./micromark-util-combine-extensions-34ef5cdc.js";import"./micromark-util-chunked-6f054bfc.js";import"./micromark-factory-space-62b287c8.js";import"./micromark-util-character-b4c2c3b7.js";import"./micromark-core-commonmark-c7408300.js";import"./micromark-util-classify-character-b0dd44a1.js";import"./micromark-util-resolve-all-8a85a8df.js";import"./decode-named-character-reference-29ded5ae.js";import"./micromark-util-subtokenize-d9357da7.js";import"./micromark-factory-destination-cef6acfb.js";import"./micromark-factory-label-01414396.js";import"./micromark-factory-title-1a18636a.js";import"./micromark-factory-whitespace-7a4e1cef.js";import"./micromark-util-normalize-identifier-dfdf0387.js";import"./micromark-util-html-tag-name-eaa6d7c0.js";import"./micromark-util-decode-numeric-character-reference-bd25dc10.js";import"./micromark-util-decode-string-02bf9559.js";import"./unist-util-stringify-position-7b16d8bf.js";import"./mdast-util-to-string-bfd41500.js";import"./highlight.js-1a8a02da.js";import"./bigonion-kit-f58b431d.js";import"./markdown-it-467cea12.js";import"./mdurl-d7fdfec3.js";import"./uc.micro-2ff9f57e.js";import"./entities-52510f6e.js";import"./linkify-it-c9428ec8.js";import"./punycode.js-c41da3d1.js";import"./markdown-it-multimd-table-ba40a09e.js";import"./markdown-it-github-toc-5499209a.js";import"./uslug-b4eaf0e7.js";import"./unorm-1228fe77.js";import"./markdown-it-task-lists-93838a7e.js";import"./markdown-it-emoji-66d1da7f.js";import"./markdown-it-footnote-bb754603.js";import"./i18next-2edfafb0.js";import"./react-i18next-2995e720.js";import"./@monaco-editor-0dd05a9a.js";import"./state-local-dd516420.js";import"./html2canvas-a81bcda4.js";import"./react-resizable-63341ac4.js";import"./react-draggable-845bf1f5.js";import"./monaco-editor-5c968e0a.js";/* empty css                      */import"./i18next-browser-languagedetector-953d2d0b.js";const O="409f1e38b0d8586919166aa6117243f7.AVQTIQqUbGI1g8B5",ie="https://open.bigmodel.cn/api/paas/v4/chat/completions";class se{static token=O;async askAI(p,f,i,a,m,c){const v=()=>c?[{type:"image_url",image_url:{url:c}},{type:"text",text:p}]:p,B={model:c?"glm-4v-plus-0111":"glm-4-flash",tool:"web-search-pro",stream:!0,messages:[{role:"system",content:"你是一个专门为markdown写作输出内容的AI助手，严禁废话，若用户问换行符号怎么写，你的回答只需要：<br>"},{role:"system",content:"你作为一个markdownAI助手，只需要回答markdown格式纯文本即可，不要用markdown代码包裹回答，除非用户主动要求"},{role:"system",content:"所有数学/公式/定律/方程必须遵循:行内公式用单$包裹，公式块用两个$$包裹！严谨直接打印出来"},{role:"system",content:"用户问你思维导图/饼图等mermaid的语法图怎么写，你需要回答正确语法的mermaid内容，如```mermaid \n graph TD;\nA[人工智能学习思维导图] --> B[基础知识];\nB --> B1[数学基础];```"},{role:"system",content:f??`用户鼠标选中了这一段文本：${f}可能需要修改，扩写等对这段文本操作，你只需要回答修改后的文本即可`},{role:"user",content:v()}]};try{const s=await fetch(ie,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`${O}`},body:JSON.stringify(B)});if(!s.body)throw new Error("ReadableStream not supported in this browser.");const S=s.body.getReader(),d=new TextDecoder("utf-8");let I=!1,g="";for(;!I;){const{value:R,done:h}=await S.read();if(I=h,R){const x=d.decode(R,{stream:!0}).split(`
`).filter(n=>n.trim()!=="");for(const n of x)if(n.startsWith("data:")){const b=n.replace("data:","").trim();if(b==="[DONE]"){a(g);return}try{const w=JSON.parse(b).choices[0].delta?.content;w&&(g+=w,i(w))}catch(y){console.error("JSON parse error:",y),m(y)}}}}}catch(s){console.error("Error:",s),m(s)}}}const le=new se,z=".prompt-panel-content",k=e.memo(X("button")(({theme:P})=>({background:"none",border:"none",cursor:"pointer",padding:0,"&:hover":{backgroundColor:W()==="light"?"rgba(238, 238, 238, 0.9)":"rgba(66, 165, 245, 0.9)",borderColor:"#0062cc",transition:"background-color 0.4s ease-in-out, opacity 0.4s ease-in-out"},transition:"background-color 0.4s ease-in-out, opacity 0.4s ease-in-out",color:W()==="light"?"black":"white",height:"6svh",fontSize:"0.83rem",borderRadius:"55px",display:"flex",alignItems:"center",justifyContent:"center"}))),eo=Q(function(p){const f={posx:window.document.body.clientWidth/4,posy:window.document.body.clientHeight/2.5},i=r.useRef(null),a=r.useRef(null),m=r.useRef(null),[c,v]=r.useState(!1),[B,s]=r.useState(!1),[S,d]=r.useState(""),[I,g]=r.useState(!1),[R,h]=r.useState(!1),[C,x]=r.useState(""),n=r.useRef(null);e.useEffect(()=>{a.current&&setTimeout(()=>{a.current.focus()},100),v(p.open),p.open?$.fromTo(z,{x:0},{x:20,opacity:1,duration:.6}):$.to(z,{opacity:0,duration:.4,onComplete:()=>{}})},[p.open]);const b=()=>{ae({unmemorable:{aiPanelState:!1}})},y=t=>{i.current&&!i.current.contains(t.target)&&b()},F=t=>{i.current&&!i.current.contains(t.target)&&(b(),t.preventDefault())},w=t=>{t.ctrlKey&&t.key==="Enter"&&(M(),a.current.value="")},L=t=>{if(t.clipboardData&&t.clipboardData.items)for(let o=0;o<t.clipboardData.items.length;o++){const u=t.clipboardData.items[o];if(u.type.indexOf("image")!==-1){const E=u.getAsFile();if(E){const A=new FileReader;A.onload=D=>{const K=D.target?.result;x(K)},A.readAsDataURL(E)}}}},U=()=>{n.current?.click()},j=t=>{const o=t.target.files;if(o&&o.length>0){const u=o[0],E=new FileReader;E.onload=A=>{const D=A.target?.result;x(D)},E.readAsDataURL(u)}},M=()=>{const t=a.current.value;t&&(s(!0),d(""),h(!0),g(!1),le.askAI(t,re(),o=>{m.current&&m.current.scrollTo(0,1e4),d(u=>u+o),h(!1)},o=>{d(o),g(!0)},o=>{console.error("AI 请求错误:",o),d("抱歉，发生了错误，可能是宿主没充钱，请联系他olderonion@gmail.com :("),h(!1)},C),a.current.value="",_())},_=()=>{n.current&&(n.current.value=""),x("")},J=()=>{ne(S,!1)};return e.createElement(e.Fragment,null,e.createElement(q,{invisible:!0,transitionDuration:{appear:500,enter:500,exit:1e3},sx:{zIndex:t=>t.zIndex.drawer+1,pointerEvents:c?"auto":"none"},open:c,onContextMenu:F,onMouseUp:y},e.createElement(l,{ref:i,className:"prompt-panel-content",onClick:t=>{t.preventDefault(),t.stopPropagation()},sx:{width:"50svw",position:"absolute",display:"flex",flexDirection:"column",top:f.posy-window.document.body.clientHeight*.1,left:f.posx-window.document.body.clientWidth*.02,borderRadius:"25px",boxShadow:"7px 6px 12px 7px rgb(0 0 0 / 21%)",backgroundColor:W()==="light"?"white":"#333"}},B?e.createElement(e.Fragment,null,e.createElement(l,{sx:{padding:"21px 2vw 4px 16px"}},e.createElement(oe,{ref:m,sx:{height:"20svh",width:"48svw"}},e.createElement(G,{variant:"body1",gutterBottom:!0,sx:{whiteSpace:"pre-wrap"}},R?"AI 正在思考中...":S))),e.createElement(H,null)):null,e.createElement(l,{className:"FLEX COW",sx:{alignItems:"flex-end"}},e.createElement(l,{sx:{padding:"21px 6px 4px 16px",ml:1,flex:"0 0 89%"}},e.createElement(N,{autoFocus:!0,multiline:!0,className:"transparent-scrollbar",onKeyDown:w,onPaste:L,fullWidth:!0,inputRef:a,maxRows:5,placeholder:"Search in GLM-4 AI Model",inputProps:{"aria-label":"search google maps"}})),e.createElement(l,null,e.createElement(k,{style:{padding:"0px 20px",fontWeight:"700"},onClick:M,"aria-label":"发送"},e.createElement(V,null)))),e.createElement(l,{className:"FLEX COW"},e.createElement(T,{title:"Ctrl+J"},e.createElement(k,{style:{padding:"0px 20px",fontWeight:"700"}},e.createElement(Y,null)," Ask AI")),e.createElement(T,{title:"选择图片"},e.createElement(k,{onClick:U,"aria-label":"选择图片",style:{padding:"0px 20px",fontWeight:"700"}},e.createElement(Z,null))),e.createElement(N,{multiline:!0,disabled:!0,fullWidth:!0,sx:{ml:1,flex:1},maxRows:5,placeholder:"Press Ctrl + Enter To Send",inputProps:{"aria-label":"search google maps"}}),C&&e.createElement(l,{sx:{ml:1,position:"relative",display:"inline-block"}},e.createElement("img",{src:C,alt:"图片预览",style:{width:35,height:35,borderRadius:"1px",objectFit:"cover"}}),e.createElement(k,{onClick:()=>_(),"aria-label":"删除图片",style:{position:"absolute",top:-8,right:-8,backgroundColor:"rgba(255,255,255,0.8)",borderRadius:"50%",width:20,height:20,padding:0,zIndex:1}},e.createElement(ee,{style:{fontSize:16}}))),e.createElement(T,{title:"接受AI并插入编辑器"},e.createElement(k,{onClick:J,"aria-label":"插入",disabled:!I,style:{padding:"0px 20px",fontWeight:"700"}},e.createElement(te,null)))))),e.createElement("input",{type:"file",accept:"image/*",ref:n,style:{display:"none"},onChange:j}))});export{eo as default};
