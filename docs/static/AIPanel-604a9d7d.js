import{i as Q,a as P,A as G,B as H,z as V,D as X}from"./index-6f98314d.js";import{o as Y}from"./mobx-react-1c6baff6.js";import{s as Z,M as ee,x as l,y as te,j as oe,aJ as L,aK as ne,T as M,aq as ae,aL as re,k as se,aM as le}from"./@mui-fa711f64.js";import"./react-dom-d3bdc6a0.js";import"./monaco-editor-5cf1114e.js";/* empty css                      */import"./i18next-c75e253c.js";import"./react-i18next-0e366d71.js";import"./clsx-0839fdbe.js";import"./@monaco-editor-863e66c9.js";import"./state-local-dd516420.js";import"./react-resizable-cd8174cc.js";import"./react-draggable-424a1664.js";import"./prop-types-d9a440a1.js";import"./@babel-e5f941c7.js";import"./i18next-browser-languagedetector-ac00b891.js";import"./react-2b221fbb.js";import"./@emotion-307c4334.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./stylis-79144faa.js";import"./react-transition-group-6566369a.js";import"./@popperjs-61ffd834.js";import"./mobx-3741033e.js";import"./mobx-react-lite-1ad052b5.js";import"./use-sync-external-store-b84fba6b.js";const N="409f1e38b0d8586919166aa6117243f7.AVQTIQqUbGI1g8B5",ie="https://open.bigmodel.cn/api/paas/v4/chat/completions";class ce{static token=N;async askAI(i,f,r,a,c,p){const B=()=>p?[{type:"image_url",image_url:{url:p}},{type:"text",text:i}]:i,D={model:p?"glm-4v-plus-0111":"glm-4-flash",tool:"web-search-pro",stream:!0,messages:[{role:"system",content:"你是一个专门为markdown写作输出内容的AI助手，严禁废话，若用户问换行符号怎么写，你的回答只需要：<br>"},{role:"system",content:"你作为一个markdownAI助手，只需要回答markdown格式纯文本即可，不要用markdown代码包裹回答，除非用户主动要求"},{role:"system",content:"所有数学/公式/定律/方程必须遵循:行内公式用单$包裹，公式块用两个$$包裹！严谨直接打印出来"},{role:"system",content:"用户问你思维导图/饼图等mermaid的语法图怎么写，你需要回答正确语法的mermaid内容，如```mermaid \n graph TD;\nA[人工智能学习思维导图] --> B[基础知识];\nB --> B1[数学基础];```"},{role:"system",content:f??`用户鼠标选中了这一段文本：${f}可能需要修改，扩写等对这段文本操作，你只需要回答修改后的文本即可`},{role:"user",content:B()}]};try{const s=await fetch(ie,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`${N}`},body:JSON.stringify(D)});if(!s.body)throw new Error("ReadableStream not supported in this browser.");const I=s.body.getReader(),d=new TextDecoder("utf-8");let R=!1,g="";for(;!R;){const{value:C,done:h}=await I.read();if(R=h,C){const x=d.decode(C,{stream:!0}).split(`
`).filter(n=>n.trim()!=="");for(const n of x)if(n.startsWith("data:")){const b=n.replace("data:","").trim();if(b==="[DONE]"){a(g);return}try{const y=JSON.parse(b).choices[0].delta?.content;y&&(g+=y,r(y))}catch(w){console.error("JSON parse error:",w),c(w)}}}}}catch(s){console.error("Error:",s),c(s)}}}const pe=new ce,e=window.React,u=window.React.useState,v=window.React.useRef,O=(await Q("https://cdn.jsdmirror.com/npm/gsap@3.12/+esm")).gsap,_=".prompt-panel-content",k=e.memo(Z("button")(({theme:W})=>({background:"none",border:"none",cursor:"pointer",padding:0,"&:hover":{backgroundColor:P()==="light"?"rgba(238, 238, 238, 0.9)":"rgba(66, 165, 245, 0.9)",borderColor:"#0062cc",transition:"background-color 0.4s ease-in-out, opacity 0.4s ease-in-out"},transition:"background-color 0.4s ease-in-out, opacity 0.4s ease-in-out",color:P()==="light"?"black":"white",height:"6svh",fontSize:"0.83rem",borderRadius:"55px",display:"flex",alignItems:"center",justifyContent:"center"}))),je=Y(function(i){const f={posx:window.document.body.clientWidth/4,posy:window.document.body.clientHeight/2.5},r=v(null),a=v(null),c=v(null),[p,B]=u(!1),[D,s]=u(!1),[I,d]=u(""),[R,g]=u(!1),[C,h]=u(!1),[S,x]=u(""),n=v(null);e.useEffect(()=>{a.current&&setTimeout(()=>{a.current.focus()},100),B(i.open),i.open?O.fromTo(_,{x:0},{x:20,opacity:1,duration:.6}):O.to(_,{opacity:0,duration:.4,onComplete:()=>{}})},[i.open]);const b=()=>{X({unmemorable:{aiPanelState:!1}})},w=t=>{r.current&&!r.current.contains(t.target)&&b()},F=t=>{r.current&&!r.current.contains(t.target)&&(b(),t.preventDefault())},y=t=>{t.ctrlKey&&t.key==="Enter"&&($(),a.current.value="")},z=t=>{if(t.clipboardData&&t.clipboardData.items)for(let o=0;o<t.clipboardData.items.length;o++){const m=t.clipboardData.items[o];if(m.type.indexOf("image")!==-1){const E=m.getAsFile();if(E){const A=new FileReader;A.onload=T=>{const q=T.target?.result;x(q)},A.readAsDataURL(E)}}}},U=()=>{n.current?.click()},J=t=>{const o=t.target.files;if(o&&o.length>0){const m=o[0],E=new FileReader;E.onload=A=>{const T=A.target?.result;x(T)},E.readAsDataURL(m)}},$=()=>{const t=a.current.value;t&&(s(!0),d(""),h(!0),g(!1),pe.askAI(t,H(),o=>{c.current&&c.current.scrollTo(0,1e4),d(m=>m+o),h(!1)},o=>{d(o),g(!0)},o=>{console.error("AI 请求错误:",o),d("抱歉，发生了错误，可能是宿主没充钱，请联系他olderonion@gmail.com :("),h(!1)},S),a.current.value="",j())},j=()=>{n.current&&(n.current.value=""),x("")},K=()=>{V(I,!1)};return e.createElement(e.Fragment,null,e.createElement(ee,{invisible:!0,transitionDuration:{appear:500,enter:500,exit:1e3},sx:{zIndex:t=>t.zIndex.drawer+1,pointerEvents:p?"auto":"none"},open:p,onContextMenu:F,onMouseUp:w},e.createElement(l,{ref:r,className:"prompt-panel-content",onClick:t=>{t.preventDefault(),t.stopPropagation()},sx:{width:"50svw",position:"absolute",display:"flex",flexDirection:"column",top:f.posy-window.document.body.clientHeight*.1,left:f.posx-window.document.body.clientWidth*.02,borderRadius:"25px",boxShadow:"7px 6px 12px 7px rgb(0 0 0 / 21%)",backgroundColor:P()==="light"?"white":"#333"}},D?e.createElement(e.Fragment,null,e.createElement(l,{sx:{padding:"21px 2vw 4px 16px"}},e.createElement(G,{ref:c,sx:{height:"20svh",width:"48svw"}},e.createElement(te,{variant:"body1",gutterBottom:!0,sx:{whiteSpace:"pre-wrap"}},C?"AI 正在思考中...":I))),e.createElement(oe,null)):null,e.createElement(l,{className:"FLEX COW",sx:{alignItems:"flex-end"}},e.createElement(l,{sx:{padding:"21px 6px 4px 16px",ml:1,flex:"0 0 89%"}},e.createElement(L,{autoFocus:!0,multiline:!0,className:"transparent-scrollbar",onKeyDown:y,onPaste:z,fullWidth:!0,inputRef:a,maxRows:5,placeholder:"Search in GLM-4 AI Model",inputProps:{"aria-label":"search google maps"}})),e.createElement(l,null,e.createElement(k,{style:{padding:"0px 20px",fontWeight:"700"},onClick:$,"aria-label":"发送"},e.createElement(ne,null)))),e.createElement(l,{className:"FLEX COW"},e.createElement(M,{title:"Ctrl+J"},e.createElement(k,{style:{padding:"0px 20px",fontWeight:"700"}},e.createElement(ae,null)," Ask AI")),e.createElement(M,{title:"选择图片"},e.createElement(k,{onClick:U,"aria-label":"选择图片",style:{padding:"0px 20px",fontWeight:"700"}},e.createElement(re,null))),e.createElement(L,{multiline:!0,disabled:!0,fullWidth:!0,sx:{ml:1,flex:1},maxRows:5,placeholder:"Press Ctrl + Enter To Send",inputProps:{"aria-label":"search google maps"}}),S&&e.createElement(l,{sx:{ml:1,position:"relative",display:"inline-block"}},e.createElement("img",{src:S,alt:"图片预览",style:{width:35,height:35,borderRadius:"1px",objectFit:"cover"}}),e.createElement(k,{onClick:()=>j(),"aria-label":"删除图片",style:{position:"absolute",top:-8,right:-8,backgroundColor:"rgba(255,255,255,0.8)",borderRadius:"50%",width:20,height:20,padding:0,zIndex:1}},e.createElement(se,{style:{fontSize:16}}))),e.createElement(M,{title:"接受AI并插入编辑器"},e.createElement(k,{onClick:K,"aria-label":"插入",disabled:!R,style:{padding:"0px 20px",fontWeight:"700"}},e.createElement(le,null)))))),e.createElement("input",{type:"file",accept:"image/*",ref:n,style:{display:"none"},onChange:J}))});export{je as default};
