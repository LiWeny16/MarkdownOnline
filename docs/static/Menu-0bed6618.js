import{s as Re,aj as Pe,D as Q,a as ie,b as ce,T as _e,ak as se,e as de,B,al as we,am as x,an as be,ao as $e,d as Ee,ap as Be,v as d,aq as Oe,ar as Y,M as Ne,E as je,as as Xe,at as qe,au as Je,av as Se,ab as Ve,aw as He,w as h,ax as Ge,S as Ke,G as De,j as Z,ay as Ye,az as Ce,aA as ye,V as Qe,aB as ge,aC as Ze,N as We,aD as et,aE as tt,aF as nt,aG as at,aH as lt,aI as ot,aJ as st,ai as rt,aK as it,a5 as ct,W as dt,aL as mt}from"./@mui-83912af0.js";import{g as re,i as le,m as Le,e as ut,n as ht,a as v,b as R,I as ke,s as gt,c as pt,d as ft,f as q,h as ve,j as Te,k as Et,S as xt,l as wt,o as bt,L as St,r as Ct,p as fe,q as ze,t as yt,u as kt,v as vt,w as zt,x as It,C as Mt,y as At,z as Ft,A as Rt}from"./index-686fe139.js";import{o as Ue}from"./mobx-react-1c6baff6.js";import{u as ee}from"./react-i18next-0e366d71.js";import"./react-2b221fbb.js";import"./clsx-0839fdbe.js";import"./@emotion-22635a5b.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-bc930cec.js";import"./stylis-79144faa.js";import"./react-transition-group-45d74422.js";import"./@popperjs-61ffd834.js";import"./prop-types-4dcdfe56.js";import"./react-dom-d3bdc6a0.js";import"./monaco-editor-5cf1114e.js";/* empty css                      */import"./i18next-c75e253c.js";import"./@monaco-editor-863e66c9.js";import"./state-local-dd516420.js";import"./react-resizable-95d32b79.js";import"./react-draggable-e660ef73.js";import"./i18next-browser-languagedetector-ac00b891.js";import"./mobx-3741033e.js";import"./mobx-react-lite-1ad052b5.js";import"./use-sync-external-store-b84fba6b.js";const Bt=window.React,xe=Re(s=>Bt.createElement(Pe,{elevation:0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},...s}))(({theme:s})=>({"& .MuiPaper-root":{borderRadius:6,marginTop:s.spacing(1),color:s.palette.mode==="light"?"rgb(55, 65, 81)":s.palette.grey[300],"& .MuiMenu-list":{padding:"4px 0"},"& .MuiMenuItem-root":{"& .MuiSvgIcon-root":{fontSize:20,color:s.palette.mode==="light"?"rgb(55, 65, 81)":s.palette.grey[300],marginRight:s.spacing(1.5)}}}})),y=window.React;function Dt(s){const{t}=ee();y.useRef();let[n,a]=y.useState(!1);const[l,o]=y.useState("https://bigonion.cn"),[b,k]=y.useState(!1);let z=A=>{a(()=>!1),s.onClick(A)},I=async A=>{re()};const D=A=>_=>{_.stopPropagation(),window.location.href=A},E=()=>{navigator.clipboard.writeText(l).then(()=>{k(!0),setTimeout(()=>k(!1),2e3)}).catch(A=>{console.error("Failed to copy URL:",A)})};return y.createElement(y.Fragment,null,y.createElement(Q,{fullWidth:!0,maxWidth:"sm",open:n,onClose:z},y.createElement(ie,null,"真·分享"),y.createElement(ce,null,y.createElement(_e,{title:b?"已复制!":"点击复制"},y.createElement(se,{value:l,variant:"outlined",fullWidth:!0,InputProps:{readOnly:!0},onClick:E}))),y.createElement(de,null,y.createElement(B,{onClick:I},"创建分享链接"))),y.createElement(we,null),t("t-share"),y.createElement(xe,{style:{width:"fitContent"},anchorOrigin:{vertical:-5,horizontal:12},id:"demo-customized-menu",MenuListProps:{"aria-labelledby":"demo-customized-button"},elevation:24,anchorEl:s.anchorEl,open:s.open,onClick:s.onClick},y.createElement(x,{onClick:A=>{A.stopPropagation(),a(!0)},disabled:!0,disableRipple:!0},y.createElement(we,null),"真·分享"),y.createElement(x,{onClick:D("weixin://dl/scan"),disableRipple:!0},y.createElement(be,null),"WeChat"),y.createElement(x,{onClick:D("tg://"),disableRipple:!0},y.createElement(be,null),"Telegram"),y.createElement(x,{onClick:D("mailto:bigonion@bigonion.cn?subject=你的主题&body=你的邮件内容"),disableRipple:!0},y.createElement($e,null),"Email")))}const Wt=(await le("https://cdn.jsdmirror.com/npm/bigonion-kit@0.12.6/esm/kit.min.js")).default;function Lt(){let s=re()??"";Wt.sleep(250).then(()=>{var t=document.createElement("a");t.href="data:text/plain;charset=utf-8,"+encodeURIComponent(s),t.download="text.md",t.click()})}const g=window.React;function Tt(s){const{t}=ee();let n=s.closeExportMenu,[a,l]=g.useState(!1),o=E=>{console.log(E),n(E),l(()=>!1)},b=g.useRef();const[k,z]=g.useState(3),I=E=>{E.stopPropagation(),z(E.target.value)};let D=E=>{o(E);let A=b.current.value;ut(k??4,A??"md_snapshot.png"),s.closeMenu(E),ht("导出成功！","Beta版本",{kind:"info",position:"topRight"})};return g.createElement(g.Fragment,null,g.createElement(Q,{className:"avoid",onClose:o,open:a,fullWidth:!0,maxWidth:"sm"},g.createElement("div",{onClick:E=>{E.stopPropagation()}},g.createElement(ie,null,"导出设置"),g.createElement(ce,null,g.createElement(Ee,null,"请选择图片清晰度"),g.createElement("br",null),g.createElement(Be,{fullWidth:!0},g.createElement(d,null,g.createElement(Oe,{id:"demo-simple-select-label"},"图片清晰度"),g.createElement(Y,{label:"图片清晰度",defaultValue:"4",defaultChecked:!0,fullWidth:!0,onChange:I},g.createElement(x,{value:"1"},"1 (比较模糊,体积轻巧)"),g.createElement(x,{value:"2"},"2 (有些模糊)"),g.createElement(x,{value:"4"},"3 (默认,适中,推荐)"),g.createElement(x,{value:"6"},"4 (比较清晰,体积稍大)"),g.createElement(x,{value:"10"},"5 (超鸡无敌霹雳霸清晰,体积较大)"))),g.createElement(d,{marginX:"8px"},g.createElement(se,{inputRef:b,margin:"dense",id:"export_img_name",defaultValue:"md_snapshot.png",label:"导出的文件名",type:"text",fullWidth:!0,variant:"standard",placeholder:"md_snapshot.png"})))),g.createElement(de,null,g.createElement(B,{onClick:o},"取消"),g.createElement(B,{onClick:D},"确认导出")))),g.createElement(Ne,null),t("t-export"),g.createElement(xe,{style:{width:"fitContent"},anchorOrigin:{vertical:-5,horizontal:12},id:"demo-customized-menu",MenuListProps:{"aria-labelledby":"demo-customized-button"},elevation:24,anchorEl:s.anchorEl,open:s.open,onClick:E=>{n(E)}},g.createElement(x,{onClick:()=>{Le()},disableRipple:!0},g.createElement(je,null),t("t-export-pdf")),g.createElement(x,{onClick:E=>{l(!0),n(E)},disableRipple:!0},g.createElement(Xe,null),t("t-export-image")),g.createElement(x,{onClick:()=>{Lt()},disableRipple:!0},g.createElement(qe,null),t("t-export-markdown"))))}const V=window.React;function Ut(s){s.preventDefault()}function Pt(){return V.createElement(d,{sx:{marginBottom:"5px"},role:"presentation",onClick:Ut},V.createElement(Je,{"aria-label":"breadcrumb"},V.createElement(Se,{underline:"hover",sx:{display:"flex",alignItems:"center"},color:"inherit",href:"/"},V.createElement(Ve,{sx:{mr:.5},fontSize:"inherit"}),"MUI"),V.createElement(Se,{underline:"hover",sx:{display:"flex",alignItems:"center"},color:"inherit",href:"/material-ui/getting-started/installation/"},V.createElement(He,{sx:{mr:.5},fontSize:"inherit"}),"Basic"),V.createElement(h,{sx:{display:"flex",alignItems:"center"},color:"text.primary"},V.createElement(Ge,{sx:{mr:.5},fontSize:"inherit"}),"Theme")))}let _t=Re(Ke)(({theme:s})=>({width:62,height:34,padding:7,"& .MuiSwitch-switchBase":{margin:1,padding:0,transform:"translateX(6px)","&.Mui-checked":{color:"#fff",transform:"translateX(22px)","& .MuiSwitch-thumb:before":{backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 20 20"><path fill="${encodeURIComponent("#fff")}" d="M4.2 2.5l-.7 1.8-1.8.7 1.8.7.7 1.8.6-1.8L6.7 5l-1.9-.7-.6-1.8zm15 8.3a6.7 6.7 0 11-6.6-6.6 5.8 5.8 0 006.6 6.6z"/></svg>')`},"& + .MuiSwitch-track":{opacity:1,backgroundColor:s.palette.mode==="dark"?"#8796A5":"#aab4be"}}},"& .MuiSwitch-thumb":{backgroundColor:s.palette.mode==="dark"?"#003892":"#001e3c",width:32,height:32,"&::before":{content:"''",position:"absolute",width:"100%",height:"100%",left:0,top:0,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 20 20"><path fill="${encodeURIComponent("#fff")}" d="M9.305 1.667V3.75h1.389V1.667h-1.39zm-4.707 1.95l-.982.982L5.09 6.072l.982-.982-1.473-1.473zm10.802 0L13.927 5.09l.982.982 1.473-1.473-.982-.982zM10 5.139a4.872 4.872 0 00-4.862 4.86A4.872 4.872 0 0010 14.862 4.872 4.872 0 0014.86 10 4.872 4.872 0 0010 5.139zm0 1.389A3.462 3.462 0 0113.471 10a3.462 3.462 0 01-3.473 3.472A3.462 3.462 0 016.527 10 3.462 3.462 0 0110 6.528zM1.665 9.305v1.39h2.083v-1.39H1.666zm14.583 0v1.39h2.084v-1.39h-2.084zM5.09 13.928L3.616 15.4l.982.982 1.473-1.473-.982-.982zm9.82 0l-.982.982 1.473 1.473.982-.982-1.473-1.473zM9.305 16.25v2.083h1.389V16.25h-1.39z"/></svg>')`}},"& .MuiSwitch-track":{opacity:1,backgroundColor:s.palette.mode==="dark"?"#8796A5":"#aab4be",borderRadius:20/2}}));const e=window.React,$t=(await le("https://cdn.jsdmirror.com/npm/mermaid@10/dist/mermaid.esm.min.mjs")).default,Ie=(await le("https://cdn.jsdmirror.com/npm/bigonion-kit@0.12.6/esm/kit.min.js")).default,N={transition:"background-color 0.4s ease, box-shadow 0.4s ease",position:"relative",padding:"5px",borderRadius:"3px",display:"flex",flexDirection:"column",mt:"10px",mb:"5px",ml:"0px",pl:"25px",willChange:"background-color, box-shadow","&::before":{content:'""',position:"absolute",left:0,top:0,height:"100%",width:4,backgroundColor:"transparent",transition:"background-color 0.2s cubic-bezier(0.5, 0.05, 1, 0.5)"}},L=s=>({"&:hover::before":{backgroundColor:v()==="light"?"#840084":"#d2d2d2"},"&:hover":{backgroundColor:v()==="light"?"#EAEAEA":"#393939",boxShadow:"0px 4px 12px rgba(20, 15, 15, 0.1)"}}),Ot=Ue(function(){const{t,i18n:n}=ee();v();const a=De(),l={...N,transition:"background-color 2s ease, box-shadow 0.4s ease","&::before":{...N["&::before"],transition:"background-color 0.24s ease 0.1s"}},o={color:a.palette.info.contrastText??"#8B8A8A",fontSize:"0.79rem",fontWeight:500,mb:"5px"},[b,k]=e.useState(!1),z=i=>{q({advanced:{imageSettings:{...R().advanced.imageSettings,modePrefer:i.target.value==="folder"?"folder":"vf"}}})},I=i=>{q({advanced:{imageSettings:{...R().advanced.imageSettings,basicStyle:i.target.value}}})},D=i=>{q({advanced:{imageSettings:{...R().advanced.imageSettings,imgStorePath:i.target.value}}})};function E(i,w){const G=document.querySelector(".markdown-body");w?(ve("dark"),k(i.target.checked),G.style.cssText=""):(ve("light"),k(i.target.checked))}function A(i,w){w?q({basic:{syncScroll:!0}}):q({basic:{syncScroll:!1}})}function _(i){q({basic:{speechLanguage:i.target.value}})}function $(i){q({basic:{fontSize:i.target.value}}),document.getElementsByClassName("fontSizeStyle")&&(Ie.removeAddedStyle("fontSizeStyle"),Ie.addStyle(`
      .markdown-body p,
      .markdown-body ol,
      .markdown-body li,
      .markdown-body div {
          font-size: ${R().basic.fontSize}px;
      }
        `,"fontSizeStyle"))}function W(i){q({basic:{editorAutoWrap:i.target.value===1}}),window.editor.updateOptions({wordWrap:R().basic.editorAutoWrap?"on":"off"})}function u(i){q({basic:{fontFamily:i.target.value===1?"Times New Roman":'-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji"'}})}function S(i){let w=i.target.value;n.changeLanguage(i.target.value),document.documentElement.lang=i.target.value,Te({memorable:{languageChanged:!0}}),q({basic:{language:w}})}function p(i){q({advanced:{mermaidTheme:i.target.value}}),$t.init({theme:i.target.value}),Et()}return e.useEffect(()=>{k(v()==="dark")},[v()]),e.createElement(e.Fragment,null,e.createElement(d,{className:"transparent-scrollbar",sx:{width:"100%",padding:"1rem",display:"flex",flexDirection:"column",fontSize:"0.89rem",maxHight:"200px",overflowY:"scroll"}},e.createElement(h,{id:"settings_1_x",sx:{fontSize:"30px",fontWeight:"700"}},"基础设置"),e.createElement(Z,null),e.createElement(d,{id:"settings_1_1",sx:{...N,...L(v())}},e.createElement(h,{sx:{fontSize:"0.89rem",fontWeight:500}},"Theme"),e.createElement(h,{sx:o},"更改编辑器的主题"),e.createElement(_t,{checked:b,size:"small",inputProps:{"aria-label":"controlled"},onChange:E})),e.createElement(d,{id:"settings_1_2",sx:{...N,...L(v())}},e.createElement(h,{sx:{fontSize:"0.89rem",fontWeight:500}},"Language"),e.createElement(h,{sx:o},"更改编辑器的语言"),e.createElement(Y,{value:R().basic.language??"zh",defaultChecked:!0,size:"small",color:"primary",onChange:S},e.createElement(x,{value:"zh"},"中文"),e.createElement(x,{value:"en"},"English"))),e.createElement(Me,{id:"settings_1_3",content:"编辑器设置"}),e.createElement(d,{sx:{...N,...L(v())},id:"settings_1_2"},e.createElement(d,{sx:{...l,...L(v())}},e.createElement(d,{className:"FLEX ROW"},e.createElement(h,{sx:{fontSize:"0.89rem",fontWeight:500}},"Font Size")),e.createElement(h,{sx:o},"更改渲染后文字字体大小"),e.createElement(Y,{value:R().basic.fontSize,defaultChecked:!0,fullWidth:!0,size:"small",onChange:$},[...Array(10).keys()].map(i=>{const w=8+i*2;return e.createElement(x,{key:w,value:w},w," px")}))),e.createElement(d,{sx:{...l,...L(v())}},e.createElement(d,{className:"FLEX ROW"},e.createElement(h,{sx:{fontSize:"0.89rem",fontWeight:500}},"Font Family")),e.createElement(h,{sx:o},"更改渲染后文字字体"),e.createElement(Y,{value:R().basic.fontFamily==="Times New Roman"?1:0,defaultChecked:!0,fullWidth:!0,size:"small",onChange:u},e.createElement(x,{value:0},"Defualt"),e.createElement(x,{value:1},"Times New Roman"))),e.createElement(d,{sx:{...N,...L(v())}},e.createElement(d,{className:"FLEX ROW"},e.createElement(h,{sx:{fontSize:"0.89rem",fontWeight:500}},"Synchronous Scrolling")),e.createElement(h,{sx:o},"同步滚动左边编辑区和预览区域。"),e.createElement(ke,{checked:R().basic.syncScroll,size:"small",inputProps:{"aria-label":"controlled"},onChange:A})),e.createElement(d,{sx:{...N,...L(v())}},e.createElement(d,{className:"FLEX ROW"},e.createElement(h,{sx:{fontSize:"0.89rem",fontWeight:500}},"Editor Auto Wrap")),e.createElement(h,{sx:o},"是否开启编辑器自动换行"),e.createElement(Y,{value:R().basic.editorAutoWrap?1:0,defaultChecked:!0,fullWidth:!0,size:"small",onChange:W},e.createElement(x,{value:1},"On"),e.createElement(x,{value:0},"OFF")))),e.createElement(d,{id:"settings_1_4",sx:{...N,...L(v())}},e.createElement(h,{sx:{fontSize:"0.89rem",fontWeight:500}},"Speech To Text"),e.createElement(h,{sx:o},"选择语音转文字的识别语言"),e.createElement(Y,{value:R().basic.speechLanguage??"zh-CN",defaultChecked:!0,fullWidth:!0,size:"small",onChange:_},gt.map((i,w)=>e.createElement(x,{key:w,value:i[0]},i[1])))),e.createElement(h,{id:"settings_2_x",sx:{mt:"20px",fontSize:"30px",fontWeight:"700"}},"高级设置（施工中）"),e.createElement(Z,null),e.createElement(d,{id:"settings_2_1",sx:{...N,...L(v())}},e.createElement(h,{sx:{fontSize:"0.89rem",fontWeight:500}},"Export Settings"),e.createElement(h,{sx:o},"更改导出设置(施工中)"),e.createElement(ke,{disabled:!0,size:"small",inputProps:{"aria-label":"controlled"}})),e.createElement(d,{sx:{...N,...L(v())}},e.createElement(h,{id:"settings_2_2",sx:{fontSize:"0.89rem",fontWeight:500}},"Mermaid Theme Configs"),e.createElement(h,{sx:o},"Mermaid流程图主题"),e.createElement(Y,{value:R().advanced.mermaidTheme??"default",defaultChecked:!0,fullWidth:!0,size:"small",color:"primary",onChange:p},pt.map((i,w)=>e.createElement(x,{key:w,value:i},ft[w])))),e.createElement(Me,{id:"settings_2_3",content:"图片设置"}),e.createElement(d,{sx:{...N,...L(v())}},e.createElement(d,{sx:{...l,...L(v())}},e.createElement(h,{id:"settings_2_3",sx:{fontSize:"0.89rem",fontWeight:500}},"Image Storage Mode Preference (Pasting)"),e.createElement(h,{sx:o},"选择粘贴图片优先存储在浏览器/文件夹"),e.createElement(Be,{sx:{transition:"inherit"}},e.createElement(Ye,{value:R().advanced.imageSettings.modePrefer,onChange:z},e.createElement(Ce,{value:"folder",control:e.createElement(ye,{sx:{"& .MuiSvgIcon-root":{fontSize:22,color:"#65C466"}}}),label:"本地文件夹 (Prefer In Local Folder)"}),e.createElement(Ce,{value:"vf",control:e.createElement(ye,{sx:{"& .MuiSvgIcon-root":{fontSize:22,color:"#65C466"}}}),label:"浏览器 (Prefer In Browser)"})))),e.createElement(d,{sx:{...l,...L(v())}},e.createElement(h,{id:"settings_2_4",sx:{fontSize:"0.89rem",fontWeight:500}},"Default Image Style"),e.createElement(h,{sx:o},"默认填充的图片样式，大小，位置等,w表示大小, c表示center, s表示shadow"),e.createElement(se,{fullWidth:!0,margin:"normal",name:"basicStyle",label:"基本样式",value:R().advanced.imageSettings.basicStyle,onChange:I})),e.createElement(d,{sx:{...l,...L(v())}},e.createElement(h,{id:"settings_2_5",sx:{fontSize:"0.89rem",fontWeight:500}},"Default Stored Path"),e.createElement(h,{sx:o},'默认粘贴图片上传的路径，如设置为"images"，则图片会上传到名根目录的一个为"images"的文件夹下，如该项为空，则保持默认的"images"文件夹'),e.createElement(se,{disabled:R().advanced.imageSettings.modePrefer==="vf",fullWidth:!0,margin:"none",name:"imgStorePath",label:"图片存储路径",value:R().advanced.imageSettings.imgStorePath,onChange:D})))))}),Me=({content:s,id:t})=>e.createElement(e.Fragment,null,e.createElement(h,{id:t,sx:{mt:"5px",fontSize:"22px",fontWeight:700}},s),e.createElement(Z,null)),P=window.React;function Nt(s){const{t}=ee();De().palette;const n=v();P.useRef();let[a,l]=P.useState(!1);P.useState("");let o=b=>{l(()=>!1),s.onClick(b),s.closeAll()};return P.createElement(P.Fragment,null,P.createElement(Q,{fullScreen:!1,maxWidth:!1,open:s.open,onClose:o,sx:{height:"100vh"}},P.createElement(d,{sx:{background:n==="light"?"#F8FAFB":"",padding:"1rem",height:"68vh",width:"70vw"}},P.createElement(Pt,null),P.createElement(Z,{sx:{my:.5}}),P.createElement(d,{sx:{height:"58vh",display:"flex",background:n==="light"?"#F8FAFB":"",padding:"5px",flexDirection:"row",borderRradius:"50px",borderRadius:"5px"}},P.createElement(xt,null),P.createElement(Ot,null)))),P.createElement(Qe,null),t("t-settings"))}class F{static instance=null;static userId=null;static peers=new Map;dataChannels=new Map;ws=null;knownUsers=new Set;setMsgFromSharing=()=>{};setFileFromSharing=()=>{};fileMetaInfo={name:"default_received_file"};constructor(){const t=wt().memorable;F.userId=t.localLANId!=="none"?t.localLANId:this.generateUUID(),t.localLANId==="none"&&Te({memorable:{localLANId:F.userId}}),this.knownUsers.add(F.userId)}static getInstance(){return F.instance||(F.instance=new F),F.instance}getUniqId(){return F.userId}async connect(t,n,a,l){try{this.setMsgFromSharing=n,this.setFileFromSharing=a;const o=this.getUniqId();this.ws=new WebSocket(t),this.ws.onopen=()=>{this.broadcastSignal({type:"discover",id:o})},this.ws.onmessage=b=>this.handleSignal(b,l),this.ws.onclose=()=>this.cleanUpConnections(l),this.ws.onerror=b=>console.error("WebSocket error:",b),window.addEventListener("beforeunload",()=>this.disconnect()),window.addEventListener("pagehide",()=>this.disconnect())}catch(o){console.log(o)}}async disconnect(t,n){n&&t&&(n(null),t(null)),this.broadcastSignal({type:"leave",id:this.getUniqId()}),this.cleanUpConnections()}cleanUpConnections(t){this.ws&&(this.ws.onclose=null,this.ws.close(),this.ws=null),F.peers.forEach(n=>n.close()),F.peers.clear(),this.dataChannels.clear(),this.knownUsers.clear(),this.knownUsers.add(F.userId),t&&t(this.getAllUsers())}async handleSignal(t,n){const a=new FileReader;a.readAsText(t.data,"utf-8"),a.onload=async()=>{const l=JSON.parse(a.result);if(l)switch(l.type){case"offer":await this.handleOffer(l);break;case"answer":await this.handleAnswer(l);break;case"candidate":await this.handleCandidate(l);break;case"discover":await this.handleDiscover(l,n);break;case"leave":this.handleLeave(l,n);break;default:console.warn("Unknown message type",l.type)}}}async handleDiscover(t,n){const a=t.id;this.knownUsers.has(a)||(this.knownUsers.add(a),await this.connectToUser(a),n(this.getAllUsers()),this.broadcastSignal({type:"discover",id:this.getUniqId()}))}handleLeave(t,n){const a=t.id;if(this.knownUsers.has(a)){this.knownUsers.delete(a);const l=F.peers.get(a);l&&(l.close(),F.peers.delete(a));const o=this.dataChannels.get(a);o&&(o.close(),this.dataChannels.delete(a)),n(this.getAllUsers()),console.log(`User ${a} has left, cleaned up resources.`)}}createPeerConnection(t){const n=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun.metered.ca:3478","stun:stun.cloudflare.com:3478"]},{urls:"turn:md.metered.live:3478",username:"f003818b5eed7f4ff58ba654",credential:"bvU4/Kv9FXr6lT6O"}]});return n.onicecandidate=a=>{a.candidate&&this.broadcastSignal({type:"candidate",candidate:a.candidate,to:t})},n.ondatachannel=a=>{this.setupDataChannel(a.channel,t)},t&&F.peers.set(t,n),n}broadcastSignal(t){if(this.ws&&this.ws.readyState===WebSocket.OPEN){const n={...t,from:F.userId};this.ws.send(JSON.stringify(n))}}getAllUsers(){return Array.from(this.knownUsers).filter(t=>t!==this.getUniqId())}async handleOffer(t){const n=this.createPeerConnection(t.from);await n.setRemoteDescription(new RTCSessionDescription(t.offer));const a=await n.createAnswer();await n.setLocalDescription(a),this.broadcastSignal({type:"answer",answer:n.localDescription,to:t.from})}async handleAnswer(t){const n=F.peers.get(t.from);n&&await n.setRemoteDescription(new RTCSessionDescription(t.answer))}async handleCandidate(t){const n=F.peers.get(t.from);n&&await n.addIceCandidate(new RTCIceCandidate(t.candidate))}setupDataChannel(t,n){t.binaryType="arraybuffer",t.onopen=()=>{console.log(`Data channel with user ${n} is open`)};let a=null;t.onmessage=l=>{if(typeof l.data=="string"){const o=JSON.parse(l.data);o.type==="file-meta"?(a={name:o.name,size:o.size,receivedSize:0,chunks:[]},T.fileMetaInfo.name=o.name):this.setMsgFromSharing(o.msg)}else if(l.data instanceof ArrayBuffer)if(a){if(a.chunks.push(l.data),a.receivedSize+=l.data.byteLength,a.receivedSize>=a.size){const o=new Blob(a.chunks);URL.createObjectURL(o),this.setFileFromSharing(o),a=null}}else console.error("Received file data but no file metadata available.")},t.onclose=()=>{console.log(`Data channel with user ${n} is closed`),this.dataChannels.delete(n)},this.dataChannels.set(n,t)}async connectToUser(t){if(!F.peers.has(t)){const n=this.createPeerConnection(t),a=n.createDataChannel("chat");this.setupDataChannel(a,t);const l=await n.createOffer();await n.setLocalDescription(l),this.broadcastSignal({type:"offer",offer:n.localDescription,to:t})}}async sendMessageToUser(t,n){const a=this.dataChannels.get(t);a?.readyState==="open"?a.send(JSON.stringify({msg:n,type:"text"})):console.error(`Data channel with user ${t} is not available.`)}async sendFileToUser(t,n){const a=this.dataChannels.get(t);if(!a||a.readyState!=="open"){console.error(`Data channel with user ${t} is not available.`);return}const l=16*1024;let o=0;const b=()=>{const k=n.slice(o,o+l),z=new FileReader;z.onload=()=>{z.result&&(a.send(z.result),o+=l,o<n.size&&b())},z.onerror=I=>{console.error("File read error:",I)},z.readAsArrayBuffer(k)};a.send(JSON.stringify({type:"file-meta",name:n.name,size:n.size})),b()}generateUUID(){return"ID"+Math.random().toString(36).substring(2,11)}isConnected(){return this.ws!==null&&this.ws.readyState===WebSocket.OPEN}getConnectedUserIds(){return this.getAllUsers()}}const T=F.getInstance(),r=window.React,jt=window.React.useCallback,Xt=window.React.useEffect,H=window.React.useState,Ae=(await le("https://cdn.jsdmirror.com/npm/gsap@3.12/+esm")).default,oe=(await le("https://cdn.jsdmirror.com/npm/bigonion-kit@0.12.6/esm/kit.min.js")).default,Fe="wss://md-server-md-server-bndnqhexdf.cn-hangzhou.fcapp.run";function qt(s){const t={borderRadius:"12px",borderColor:"#e0e0e0"},{t:n}=ee(),a=v(),[l,o]=H(null),[b,k]=H(null),[z,I]=H(!1),[D,E]=H([]),[A,_]=H(!1),[$,W]=H(null),[u,S]=H(null),[p,i]=H(null),w=C=>{const f=C.target.files?.[0]||null;f&&(S(f),W("file"))},G=()=>{i(re()),W("text")};async function ae(){_(!0);try{T.isConnected()||await T.connect(Fe,o,k,E),T.broadcastSignal({type:"discover",id:T.getUniqId()}),await oe.sleep(500)}catch(C){console.error("Search error:",C)}finally{_(!1)}}const j=jt(C=>{const f=C.currentTarget,O=(U,ue)=>{const te=document.createElement("div");f.appendChild(te);const K=f.getBoundingClientRect(),ne=Math.max(K.width,K.height),he=C.clientX-K.left-ne/2,m=C.clientY-K.top-ne/2;Ae.set(te,{width:ne,height:ne,x:he,y:m,borderRadius:"50%",opacity:1,backgroundColor:"rgba(255, 255, 255, 0.5)",position:"absolute",pointerEvents:"none",transform:"scale(0)"}),Ae.fromTo(te,{scale:0,opacity:1},{scale:ue,opacity:0,duration:2.2,ease:"power2.out",delay:U,onComplete:()=>{te.remove()}})};O(0,2),O(.2,2)},[]),J=async(C,f)=>{const O=re();try{if(await T.connectToUser(f),console.log(`Connected to user ${f}`),$==="file"&&u)await T.sendFileToUser(f,u);else if($==="text"&&p)await T.sendMessageToUser(f,p);else if($==="clip"){let U=Ct();await T.sendMessageToUser(f,await U)}else await T.sendMessageToUser(f,O);console.log(`Message sent to user ${f}`)}catch(U){console.error(`Failed to send message to user ${f}:`,U)}};Xt(()=>(s.open&&T.connect(Fe,C=>{o(C),I(!0)},C=>{k(C),I(!0)},E).catch(C=>{console.error("Failed to connect:",C)}),()=>{T.disconnect(o,k)}),[s.open]);const X=()=>{try{if(l)l?(fe("成功收到文本",2e3,{kind:"success"}),ze(window.monaco,window.editor,l)):ze(window.monaco,window.editor,l);else if(b){const C=new Blob([b]),f=T.fileMetaInfo.name,O=URL.createObjectURL(C),U=document.createElement("a");U.href=O,U.download=f,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(O)}I(!1),oe.sleep(500).then(()=>{k(null),o(null)})}catch(C){console.error("Failed to accept message:",C)}},me=C=>{s.onClick(C),s.closeAll()};return r.createElement(r.Fragment,null,r.createElement(Q,{hideBackdrop:!0,fullScreen:!1,maxWidth:!1,open:s.open,onClose:me,sx:{height:"100svh",width:"100svw"}},r.createElement(d,{sx:{height:"67svh",width:"55svw",display:"flex",background:a==="light"?"#F8FAFB":"#2B2B2B",padding:"24px",flexDirection:"column",boxShadow:"0 8px 16px rgba(0, 0, 0, 0.2)",justifyContent:"space-between",alignItems:"center",gap:"24px"}},r.createElement(d,{sx:{width:"100%",justifyContent:"flex-start",display:"flex",gap:"12px"}},r.createElement(ge,{color:"primary",badgeContent:$==="file"?1:0,overlap:"circular",sx:{"& .MuiBadge-badge":{top:"-2px",right:"-2px"}}},r.createElement(B,{variant:"outlined",sx:t,startIcon:r.createElement(Ze,null),onClick:()=>document.getElementById("file-input")?.click()},"文件")),r.createElement("input",{id:"file-input",type:"file",style:{display:"none"},onChange:w}),r.createElement(B,{disabled:!0,variant:"outlined",startIcon:r.createElement(We,null),sx:t},"文件夹"),r.createElement(ge,{sx:{"& .MuiBadge-badge":{top:"-2px",right:"-2px"}},color:"primary",badgeContent:$==="text"?1:0,overlap:"circular"},r.createElement(B,{onClick:G,variant:"outlined",startIcon:r.createElement(et,null),sx:t},"Markdown文本")),r.createElement(ge,{sx:{"& .MuiBadge-badge":{top:"-2px",right:"-2px"}},color:"primary",badgeContent:$==="clip"?1:0,overlap:"circular"},r.createElement(B,{onClick:()=>{W("clip")},variant:"outlined",startIcon:r.createElement(tt,null),sx:t},"剪贴板"))),r.createElement(d,{sx:{width:"100%",height:"100%",justifyContent:"flex-start",flexDirection:"column",display:"flex"}},r.createElement(d,{sx:{mb:"10px"}},r.createElement(nt,{sx:t,onClick:ae,endIcon:r.createElement(at,null),loading:A,loadingPosition:"end",variant:"contained"},"搜索同WIFI下用户")),r.createElement(Z,null),r.createElement(d,{sx:{width:"100%",height:"100%",justifyContent:"flex-start",flexDirection:"column",display:"flex"}},r.createElement(bt,{sx:{userSelect:"none",width:"100%",height:"100%"}},D.map((C,f)=>r.createElement(d,{sx:{...N,boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.1)",position:"relative",overflow:"hidden",cursor:"pointer"},key:f,onClick:O=>{j(O),J(O,C)}},r.createElement(St,{ali:"center",jus:"center",space:[5]},r.createElement(d,{sx:{height:"100%"},className:"FLEX ALI-CEN JUS-CEN"},r.createElement(lt,null)),r.createElement("p",null,C)),r.createElement("span",{className:"ripple",style:{background:"transparent",position:"absolute",borderRadius:"50%",pointerEvents:"none",transform:"scale(0)"}})))),r.createElement(d,{className:"FLEX ALI-CEN JUS-CEN"},r.createElement("p",{style:{color:"#8B8A8A"}},"你的ID: ",T.getUniqId())))))),r.createElement(Q,{hideBackdrop:!0,open:z,onClose:()=>{I(!1),oe.sleep(500).then(()=>{k(null),o(null)})}},r.createElement(ie,null,"✨新分享"),r.createElement(ce,null,r.createElement(Ee,null,"您有来自外部的消息，是否接受？"),l?r.createElement(d,{sx:{width:"100%",height:300,overflow:"auto",padding:2,border:"1px solid #ccc",borderRadius:"4px",backgroundColor:"#f9f9f9",whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:14}},l):r.createElement(r.Fragment,null)),r.createElement(de,null,r.createElement(B,{onClick:()=>{I(!1),oe.sleep(500).then(()=>{k(null),o(null)})},color:"secondary"},"拒绝"),r.createElement(B,{onClick:X,color:"primary",autoFocus:!0},"接受"))),r.createElement(ot,null),r.createElement(h,null,n("t-collaborative-office")))}const M=window.React,pe=window.React.useState,Jt=window.React.useEffect;function Vt(s){ee();const t=v(),n=u=>{s.onClick(u),s.closeAll()},[a,l]=pe({}),[o,b]=pe({}),[k,z]=pe({});Jt(()=>{W.forEach(async u=>{await yt(u.id)?(l(p=>({...p,[u.id]:"installed"})),z(p=>({...p,[u.id]:!0}))):l(p=>({...p,[u.id]:"not_installed"}))})},[]);const I=(u,S)=>{const p=W[u];if(!p)return;const{url:i,id:w}=p;switch(S){case"install":D(u,i,w);break;case"stop":A(w);break;case"uninstall":_(w);break;case"toggleEnable":$(w);break}},D=(u,S,p)=>{let w=!1;l(j=>({...j,[p]:"downloading"})),b(j=>({...j,[p]:0}));const G=Date.now();kt(S,p,j=>{if(j>=0&&b(J=>({...J,[p]:j})),j===100){const J=Date.now()-G;J<2500?setTimeout(()=>{w||(fe("成功安装字典！",2e3,{kind:"success"}),l(X=>({...X,[p]:"installed"})),z(X=>({...X,[p]:!0})))},2500-J):w||(fe("成功安装字典！",2e3,{kind:"success"}),l(X=>({...X,[p]:"installed"})),z(X=>({...X,[p]:!0})))}});const ae=()=>{w=!0,A(p)};E[p]=ae},E={},A=u=>{E[u]&&(E[u](),delete E[u]),l(S=>({...S,[u]:"not_installed"})),b(S=>({...S,[u]:0}))},_=async u=>{const S=await vt("cache_DB");zt(S,"data",u),l(p=>({...p,[u]:"not_installed"}))},$=u=>{z(S=>({...S,[u]:!S[u]}))},W=[{title:"Spelling Association",description:"拼写补全(只支持英文),安装会在本地下载词典",url:`https://${window._cdn.cdn[0]}/npm/an-array-of-english-words@2.0.0/index.json`,id:"spelling_data_json"},{title:"Spelling Check",description:"拼写检查,经费不足,咱不用了！",url:"https://jsonplaceholder.typicode.com/todos/2",id:"check_spell"}];return M.createElement(M.Fragment,null,M.createElement(Q,{className:"transparent-scrollbar",hideBackdrop:!1,fullScreen:!1,maxWidth:!1,open:s.open,onClose:n,sx:{height:"100svh",width:"100svw",display:"flex",justifyContent:"center",alignItems:"center"}},M.createElement(d,{className:"transparent-scrollbar",sx:{overflowX:"hidden",height:"50svh",width:"50svw",display:"flex",flexDirection:"column",background:t==="light"?"#F8FAFB":"#2B2B2B",padding:"24px",boxShadow:"0 8px 16px rgba(0, 0, 0, 0.2)",alignItems:"center"}},M.createElement(h,{fontSize:30,fontWeight:"bold",textAlign:"center"},"前端实验室"),M.createElement(Z,{sx:{width:"100%",my:2}}),M.createElement(d,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"24px",width:"100%"}},W.map((u,S)=>{const p=a[u.id]||"not_installed",i=k[u.id]??!0;return M.createElement(st,{key:S,sx:{width:"250px",height:"220px",borderRadius:"12px",boxShadow:3,display:"flex",flexDirection:"column",justifyContent:"space-between",padding:2}},M.createElement(d,{sx:{flex:1}},M.createElement(h,{variant:"h6",sx:{fontWeight:"bold"}},u.title),M.createElement(h,{variant:"body2",color:"textSecondary"},u.description)),M.createElement(d,{sx:{display:"flex",justifyContent:"space-between",gap:1}},p==="not_installed"&&M.createElement(B,{variant:"contained",color:"primary",sx:{flex:1,minWidth:"64px",height:"42px"},onClick:()=>I(S,"install")},"安装"),p==="downloading"&&M.createElement(B,{variant:"contained",color:"error",sx:{flex:1,display:"flex",minWidth:"64px",height:"42px",alignItems:"center",justifyContent:"center"},onClick:()=>I(S,"stop")},M.createElement(rt,{size:20,sx:{color:"white",marginRight:1}})),p==="installed"&&M.createElement(M.Fragment,null,M.createElement(B,{variant:"contained",color:"secondary",sx:{flex:1},onClick:()=>I(S,"uninstall")},"卸载"),M.createElement(B,{variant:"contained",color:i?"success":"warning",sx:{flex:1},onClick:()=>I(S,"toggleEnable")},i?"禁用":"启用"))))})))),M.createElement(it,null),M.createElement(h,null,"前端实验室"))}const c=window.React,Sn=Ue(()=>{const{t:s}=ee(),t=Rt(),[n,a]=c.useState(null),[l,o]=c.useState(null),[b,k]=c.useState(null),[z,I]=c.useState(null),[D,E]=c.useState(null),[A,_]=c.useState(null),[$,W]=c.useState(!1),u=!!n,S=!!l,p=!!b,i=!!z,w=!!D,G=!!A,ae=m=>{a(m.currentTarget)},j=m=>{o(m.currentTarget),m.stopPropagation()},J=async m=>{await At()?(k(m.target),m.stopPropagation()):(m.stopPropagation(),f(),W(!0))},X=m=>{I(m.currentTarget)},me=m=>{E(m.currentTarget)},C=m=>{_(m.currentTarget)},f=()=>{a(null)},O=m=>{o(null),m.stopPropagation()},U=m=>{k(null),m.stopPropagation()},ue=m=>{I(null),m.stopPropagation()},te=m=>{E(null),m.stopPropagation()},K=m=>{_(null),m.stopPropagation()},ne=()=>{t.display(),f()},he=()=>{Ft(!0),f()};return c.createElement("div",null,c.createElement(Q,{open:$,onClose:()=>{W(!1)}},c.createElement(ie,null,c.createElement(h,{variant:"h6",gutterBottom:!0},"确定导出吗，你还没有保存呢！")),c.createElement(ce,null,c.createElement(Ee,null,c.createElement(h,{variant:"body1",gutterBottom:!0},'Once you have clicked the "yes" button, your text will be saved.'))),c.createElement(de,null,c.createElement(B,{onClick:()=>{W(!1),It(),Le()}},"是嘟"),c.createElement(B,{onClick:()=>{W(!1)},autoFocus:!0},"达咩"))),c.createElement(Mt,{open:u,endIcon:c.createElement(ct,null),onClick:ae},s("t-more")),c.createElement(xe,{id:"demo-customized-menu",MenuListProps:{"aria-labelledby":"demo-customized-button"},elevation:24,anchorEl:n,open:u,onClose:f},c.createElement(x,{onClick:ne,disableRipple:!0},c.createElement(dt,null),s("t-image-manager")),c.createElement(x,{onClick:he,disableRipple:!0},c.createElement(We,null),s("t-file-manager")),c.createElement(x,{onClick:m=>{J(m)},disableRipple:!0},c.createElement(Tt,{anchorEl:b,open:p,closeMenu:f,closeExportMenu:U})),c.createElement(Z,{sx:{my:.5}}),c.createElement(x,{onClick:m=>{j(m)},disableRipple:!0},c.createElement(Dt,{closeAll:f,anchorEl:l,open:S,onClick:O})),c.createElement(x,{onClick:m=>{me(m)},disableRipple:!0},c.createElement(qt,{closeAll:f,anchorEl:D,closeMenu:f,open:w,onClick:te})),c.createElement(x,{onClick:m=>{C(m)},disableRipple:!0},c.createElement(Vt,{closeAll:f,anchorEl:A,closeMenu:K,open:G,onClick:K})),c.createElement(x,{onClick:m=>{X(m)},disableRipple:!0},c.createElement(Nt,{closeAll:f,anchorEl:z,open:i,onClick:ue})),c.createElement(x,{onClick:()=>{f()},disableRipple:!0},c.createElement(mt,null),s("t-more-coming-soon"))))});export{Sn as default};
