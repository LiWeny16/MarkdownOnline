import{R as e,r as n}from"./react-0d9c9f23.js";import{o as G}from"./mobx-react-49086c1a.js";import{g as W}from"./gsap-cf87e9ff.js";import{y as J,a4 as Q,B as o,V as D,w as Y,bj as Z,b as x,bk as ee,a_ as te,b4 as ae,bl as ne,x as oe,bm as re}from"./@mui-0903014f.js";import{a as C,x as le,y as z,z as ie,A as se,B as ce}from"./index-59a7edfc.js";import"./@babel-518c05f7.js";import"./mobx-890d6d9e.js";import"./mobx-react-lite-64872c2a.js";import"./react-dom-b710246a.js";import"./scheduler-765c72db.js";import"./use-sync-external-store-3bf5d15d.js";import"./clsx-29d81c80.js";import"./@emotion-c98c060d.js";import"./hoist-non-react-statics-3f8ebaa8.js";import"./stylis-79144faa.js";import"./react-transition-group-5217f7e1.js";import"./@popperjs-61ffd834.js";import"./prop-types-c01d55b3.js";import"./react-is-11039b32.js";import"./monaco-editor-5cf1114e.js";/* empty css                      */import"./i18next-2edfafb0.js";import"./@dnd-kit-b0134b90.js";import"./markdown-it-multimd-table-766322c9.js";import"./markdown-it-github-toc-d2e55c92.js";import"./uslug-b4eaf0e7.js";import"./unorm-1228fe77.js";import"./markdown-it-task-lists-4fbe77b0.js";import"./markdown-it-emoji-66d1da7f.js";import"./react-i18next-093df503.js";import"./@monaco-editor-41149cb1.js";import"./state-local-dd516420.js";import"./html2canvas-a81bcda4.js";import"./react-resizable-44dc0d2e.js";import"./react-draggable-4a1d91b3.js";import"./i18next-browser-languagedetector-953d2d0b.js";const F=".prompt-panel-content",s=e.memo(J("button")(({theme:P})=>({background:"none",border:"none",cursor:"pointer",padding:0,"&:hover":{backgroundColor:C()==="light"?"rgba(238, 238, 238, 0.9)":"rgba(66, 165, 245, 0.9)",borderColor:"#0062cc",transition:"background-color 0.4s ease-in-out, opacity 0.4s ease-in-out"},"&:disabled":{opacity:.5,cursor:"not-allowed"},transition:"background-color 0.4s ease-in-out, opacity 0.4s ease-in-out",color:C()==="light"?"black":"white",height:"6svh",minWidth:"60px",fontSize:"0.83rem",borderRadius:"55px",display:"flex",alignItems:"center",justifyContent:"center"}))),He=G(function(h){const R={posx:window.document.body.clientWidth/4,posy:window.document.body.clientHeight/2.5},c=n.useRef(null),r=n.useRef(null),b=n.useRef(null),[I,T]=n.useState(!1),[M,_]=n.useState(!1),[k,m]=n.useState(""),[L,y]=n.useState(!1),[U,d]=n.useState(!1),[l,u]=n.useState(!1),[E,S]=n.useState(""),f=n.useRef(null);e.useEffect(()=>{r.current&&setTimeout(()=>{r.current.focus()},100),T(h.open),h.open?W.fromTo(F,{x:0},{x:20,opacity:1,duration:.6}):W.to(F,{opacity:0,duration:.4,onComplete:()=>{}})},[h.open]);const v=()=>{ce({unmemorable:{aiPanelState:!1}})},$=t=>{c.current&&!c.current.contains(t.target)&&v()},j=t=>{c.current&&!c.current.contains(t.target)&&(v(),t.preventDefault())},N=t=>{l||t.ctrlKey&&t.key==="Enter"&&(A(),r.current.value="")},K=t=>{if(t.clipboardData&&t.clipboardData.items)for(let a=0;a<t.clipboardData.items.length;a++){const i=t.clipboardData.items[a];if(i.type.indexOf("image")!==-1){const p=i.getAsFile();if(p){const g=new FileReader;g.onload=w=>{const X=w.target?.result;S(X)},g.readAsDataURL(p)}}}},O=()=>{f.current?.click()},q=t=>{const a=t.target.files;if(a&&a.length>0){const i=a[0],p=new FileReader;p.onload=g=>{const w=g.target?.result;S(w)},p.readAsDataURL(i)}},A=()=>{const t=r.current.value;!t||l||(_(!0),m(""),d(!0),y(!1),u(!0),z.askAI(t,ie(),a=>{b.current&&b.current.scrollTo(0,1e4),m(i=>i+a),d(!1)},a=>{m(a),y(!0),u(!1)},a=>{console.error("AI 请求错误:",a),m("抱歉，发生了错误，可能是宿主没充钱，请联系他olderonion@gmail.com :("),d(!1),u(!1)},E),r.current.value="",B())},H=()=>{z.abortCurrentRequest(),u(!1),d(!1),y(!0)},B=()=>{f.current&&(f.current.value=""),S("")},V=()=>{se(k,!1)};return e.createElement(e.Fragment,null,e.createElement(Q,{invisible:!0,transitionDuration:{appear:500,enter:500,exit:1e3},sx:{zIndex:t=>t.zIndex.drawer+1,pointerEvents:I?"auto":"none"},open:I,onContextMenu:j,onMouseUp:$},e.createElement(o,{ref:c,className:"prompt-panel-content",onClick:t=>{t.preventDefault(),t.stopPropagation()},sx:{width:"50svw",position:"absolute",display:"flex",flexDirection:"column",top:R.posy-window.document.body.clientHeight*.1,left:R.posx-window.document.body.clientWidth*.02,borderRadius:"25px",boxShadow:"7px 6px 12px 7px rgb(0 0 0 / 21%)",backgroundColor:C()==="light"?"white":"#333"}},M?e.createElement(e.Fragment,null,e.createElement(o,{sx:{padding:"21px 2vw 4px 16px"}},e.createElement(le,{ref:b,sx:{height:"20svh",width:"48svw"}},e.createElement(D,{variant:"body1",gutterBottom:!0,sx:{whiteSpace:"pre-wrap"}},U?"AI 正在思考中...":k))),e.createElement(Y,null)):null,e.createElement(o,{className:"FLEX COW",sx:{alignItems:"flex-end"}},e.createElement(o,{sx:{padding:"21px 6px 4px 16px",ml:1,flex:"0 0 89%"}},e.createElement(Z,{autoFocus:!0,multiline:!0,disabled:l,className:"transparent-scrollbar",onKeyDown:N,onPaste:K,fullWidth:!0,inputRef:r,maxRows:5,placeholder:l?"AI正在回答中，请稍候...":"Search in GLM-4 AI Model",inputProps:{"aria-label":"search google maps"}})),e.createElement(o,{sx:{position:"relative",display:"inline-block"}},l?e.createElement(x,{title:"中断回答"},e.createElement(s,{style:{padding:"0px 20px",fontWeight:"700",backgroundColor:"#f44336",color:"white",minWidth:"60px",height:"6svh",transform:"scale(1)"},onClick:H,"aria-label":"中断"},e.createElement(ee,{style:{fontSize:"1.2rem"}}))):e.createElement(s,{style:{padding:"0px 20px",fontWeight:"700",minWidth:"60px",height:"6svh",transform:"scale(1)"},onClick:A,"aria-label":"发送",disabled:l},e.createElement(te,{style:{fontSize:"1.2rem"}})))),e.createElement(o,{className:"FLEX COW",sx:{alignItems:"center",paddingRight:"10px"}},e.createElement(x,{title:"Ctrl+J"},e.createElement(s,{style:{padding:"0px 20px",fontWeight:"700"}},e.createElement(ae,{style:{fontSize:"1.2rem",marginRight:"4px"}})," Ask AI")),e.createElement(x,{title:"选择图片"},e.createElement(s,{onClick:O,"aria-label":"选择图片",style:{padding:"0px 20px",fontWeight:"700"}},e.createElement(ne,{style:{fontSize:"1.2rem"}}))),e.createElement(o,{sx:{ml:1,flex:1,display:"flex",justifyContent:"center",opacity:.5,userSelect:"none"}},e.createElement(D,{variant:"caption"},"Press Ctrl + Enter To Send")),E&&e.createElement(o,{sx:{ml:1,position:"relative",display:"inline-block"}},e.createElement("img",{src:E,alt:"图片预览",style:{width:35,height:35,borderRadius:"1px",objectFit:"cover"}}),e.createElement(s,{onClick:()=>B(),"aria-label":"删除图片",style:{position:"absolute",top:-8,right:-8,backgroundColor:"rgba(255,255,255,0.8)",borderRadius:"50%",width:20,height:20,padding:0,zIndex:1}},e.createElement(oe,{style:{fontSize:16}}))),e.createElement(x,{title:"接受AI并插入编辑器"},e.createElement("span",null,e.createElement(s,{onClick:V,"aria-label":"插入",disabled:!L,style:{padding:"0px 20px",fontWeight:"700"}},e.createElement(re,{style:{fontSize:"1.2rem"}}))))))),e.createElement("input",{type:"file",accept:"image/*",ref:f,style:{display:"none"},onChange:q}))});export{He as default};
