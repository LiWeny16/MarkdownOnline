import{R as e,r as n}from"./react-0d9c9f23.js";import{o as K}from"./mobx-react-49086c1a.js";import{g as _}from"./gsap-cf87e9ff.js";import{y as Q,a3 as q,B as i,U as H,w as V,aZ as N,a_ as X,b as T,aG as Z,a$ as Y,x as ee,b0 as te}from"./@mui-859a9b9d.js";import{a as W,x as oe,y as ne,z as ae,A as re}from"./index-5462b11b.js";import"./@babel-518c05f7.js";import"./mobx-890d6d9e.js";import"./mobx-react-lite-64872c2a.js";import"./react-dom-b710246a.js";import"./scheduler-765c72db.js";import"./use-sync-external-store-3bf5d15d.js";import"./clsx-29d81c80.js";import"./@emotion-c98c060d.js";import"./hoist-non-react-statics-3f8ebaa8.js";import"./stylis-79144faa.js";import"./react-transition-group-5217f7e1.js";import"./@popperjs-61ffd834.js";import"./prop-types-c01d55b3.js";import"./react-is-11039b32.js";import"./monaco-editor-5cf1114e.js";/* empty css                      */import"./i18next-2edfafb0.js";import"./@dnd-kit-b0134b90.js";import"./markdown-it-multimd-table-766322c9.js";import"./markdown-it-github-toc-d2e55c92.js";import"./uslug-b4eaf0e7.js";import"./unorm-1228fe77.js";import"./markdown-it-task-lists-4fbe77b0.js";import"./markdown-it-emoji-66d1da7f.js";import"./react-i18next-093df503.js";import"./@monaco-editor-41149cb1.js";import"./state-local-dd516420.js";import"./html2canvas-a81bcda4.js";import"./react-resizable-44dc0d2e.js";import"./react-draggable-4a1d91b3.js";import"./i18next-browser-languagedetector-953d2d0b.js";const O="409f1e38b0d8586919166aa6117243f7.AVQTIQqUbGI1g8B5",se="https://open.bigmodel.cn/api/paas/v4/chat/completions";class le{static token=O;async askAI(c,f,s,r,p,d){const v=()=>d?[{type:"image_url",image_url:{url:d}},{type:"text",text:c}]:c,B={model:d?"glm-4v-plus-0111":"glm-4-flash",tool:"web-search-pro",stream:!0,messages:[{role:"system",content:"你是一个专门为markdown写作输出内容的AI助手，严禁废话，若用户问换行符号怎么写，你的回答只需要：<br>"},{role:"system",content:"你作为一个markdownAI助手，只需要回答markdown格式纯文本即可，不要用markdown代码包裹回答，除非用户主动要求"},{role:"system",content:"所有数学/公式/定律/方程必须遵循:行内公式用单$包裹，公式块用两个$$包裹！严谨直接打印出来"},{role:"system",content:"用户问你思维导图/饼图等mermaid的语法图怎么写，你需要回答正确语法的mermaid内容，如```mermaid \n graph TD;\nA[人工智能学习思维导图] --> B[基础知识];\nB --> B1[数学基础];```"},{role:"system",content:f??`用户鼠标选中了这一段文本：${f}可能需要修改，扩写等对这段文本操作，你只需要回答修改后的文本即可`},{role:"user",content:v()}]};try{const l=await fetch(se,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`${O}`},body:JSON.stringify(B)});if(!l.body)throw new Error("ReadableStream not supported in this browser.");const S=l.body.getReader(),m=new TextDecoder("utf-8");let I=!1,g="";for(;!I;){const{value:R,done:h}=await S.read();if(I=h,R){const x=m.decode(R,{stream:!0}).split(`
`).filter(a=>a.trim()!=="");for(const a of x)if(a.startsWith("data:")){const b=a.replace("data:","").trim();if(b==="[DONE]"){r(g);return}try{const w=JSON.parse(b).choices[0].delta?.content;w&&(g+=w,s(w))}catch(y){console.error("JSON parse error:",y),p(y)}}}}}catch(l){console.error("Error:",l),p(l)}}}const ie=new le,U=".prompt-panel-content",k=e.memo(Q("button")(({theme:P})=>({background:"none",border:"none",cursor:"pointer",padding:0,"&:hover":{backgroundColor:W()==="light"?"rgba(238, 238, 238, 0.9)":"rgba(66, 165, 245, 0.9)",borderColor:"#0062cc",transition:"background-color 0.4s ease-in-out, opacity 0.4s ease-in-out"},transition:"background-color 0.4s ease-in-out, opacity 0.4s ease-in-out",color:W()==="light"?"black":"white",height:"6svh",fontSize:"0.83rem",borderRadius:"55px",display:"flex",alignItems:"center",justifyContent:"center"}))),Ge=K(function(c){const f={posx:window.document.body.clientWidth/4,posy:window.document.body.clientHeight/2.5},s=n.useRef(null),r=n.useRef(null),p=n.useRef(null),[d,v]=n.useState(!1),[B,l]=n.useState(!1),[S,m]=n.useState(""),[I,g]=n.useState(!1),[R,h]=n.useState(!1),[C,x]=n.useState(""),a=n.useRef(null);e.useEffect(()=>{r.current&&setTimeout(()=>{r.current.focus()},100),v(c.open),c.open?_.fromTo(U,{x:0},{x:20,opacity:1,duration:.6}):_.to(U,{opacity:0,duration:.4,onComplete:()=>{}})},[c.open]);const b=()=>{re({unmemorable:{aiPanelState:!1}})},y=t=>{s.current&&!s.current.contains(t.target)&&b()},F=t=>{s.current&&!s.current.contains(t.target)&&(b(),t.preventDefault())},w=t=>{t.ctrlKey&&t.key==="Enter"&&(M(),r.current.value="")},z=t=>{if(t.clipboardData&&t.clipboardData.items)for(let o=0;o<t.clipboardData.items.length;o++){const u=t.clipboardData.items[o];if(u.type.indexOf("image")!==-1){const E=u.getAsFile();if(E){const A=new FileReader;A.onload=D=>{const G=D.target?.result;x(G)},A.readAsDataURL(E)}}}},L=()=>{a.current?.click()},j=t=>{const o=t.target.files;if(o&&o.length>0){const u=o[0],E=new FileReader;E.onload=A=>{const D=A.target?.result;x(D)},E.readAsDataURL(u)}},M=()=>{const t=r.current.value;t&&(l(!0),m(""),h(!0),g(!1),ie.askAI(t,ne(),o=>{p.current&&p.current.scrollTo(0,1e4),m(u=>u+o),h(!1)},o=>{m(o),g(!0)},o=>{console.error("AI 请求错误:",o),m("抱歉，发生了错误，可能是宿主没充钱，请联系他olderonion@gmail.com :("),h(!1)},C),r.current.value="",$())},$=()=>{a.current&&(a.current.value=""),x("")},J=()=>{ae(S,!1)};return e.createElement(e.Fragment,null,e.createElement(q,{invisible:!0,transitionDuration:{appear:500,enter:500,exit:1e3},sx:{zIndex:t=>t.zIndex.drawer+1,pointerEvents:d?"auto":"none"},open:d,onContextMenu:F,onMouseUp:y},e.createElement(i,{ref:s,className:"prompt-panel-content",onClick:t=>{t.preventDefault(),t.stopPropagation()},sx:{width:"50svw",position:"absolute",display:"flex",flexDirection:"column",top:f.posy-window.document.body.clientHeight*.1,left:f.posx-window.document.body.clientWidth*.02,borderRadius:"25px",boxShadow:"7px 6px 12px 7px rgb(0 0 0 / 21%)",backgroundColor:W()==="light"?"white":"#333"}},B?e.createElement(e.Fragment,null,e.createElement(i,{sx:{padding:"21px 2vw 4px 16px"}},e.createElement(oe,{ref:p,sx:{height:"20svh",width:"48svw"}},e.createElement(H,{variant:"body1",gutterBottom:!0,sx:{whiteSpace:"pre-wrap"}},R?"AI 正在思考中...":S))),e.createElement(V,null)):null,e.createElement(i,{className:"FLEX COW",sx:{alignItems:"flex-end"}},e.createElement(i,{sx:{padding:"21px 6px 4px 16px",ml:1,flex:"0 0 89%"}},e.createElement(N,{autoFocus:!0,multiline:!0,className:"transparent-scrollbar",onKeyDown:w,onPaste:z,fullWidth:!0,inputRef:r,maxRows:5,placeholder:"Search in GLM-4 AI Model",inputProps:{"aria-label":"search google maps"}})),e.createElement(i,null,e.createElement(k,{style:{padding:"0px 20px",fontWeight:"700"},onClick:M,"aria-label":"发送"},e.createElement(X,null)))),e.createElement(i,{className:"FLEX COW"},e.createElement(T,{title:"Ctrl+J"},e.createElement(k,{style:{padding:"0px 20px",fontWeight:"700"}},e.createElement(Z,null)," Ask AI")),e.createElement(T,{title:"选择图片"},e.createElement(k,{onClick:L,"aria-label":"选择图片",style:{padding:"0px 20px",fontWeight:"700"}},e.createElement(Y,null))),e.createElement(N,{multiline:!0,disabled:!0,fullWidth:!0,sx:{ml:1,flex:1},maxRows:5,placeholder:"Press Ctrl + Enter To Send",inputProps:{"aria-label":"search google maps"}}),C&&e.createElement(i,{sx:{ml:1,position:"relative",display:"inline-block"}},e.createElement("img",{src:C,alt:"图片预览",style:{width:35,height:35,borderRadius:"1px",objectFit:"cover"}}),e.createElement(k,{onClick:()=>$(),"aria-label":"删除图片",style:{position:"absolute",top:-8,right:-8,backgroundColor:"rgba(255,255,255,0.8)",borderRadius:"50%",width:20,height:20,padding:0,zIndex:1}},e.createElement(ee,{style:{fontSize:16}}))),e.createElement(T,{title:"接受AI并插入编辑器"},e.createElement(k,{onClick:J,"aria-label":"插入",disabled:!I,style:{padding:"0px 20px",fontWeight:"700"}},e.createElement(te,null)))))),e.createElement("input",{type:"file",accept:"image/*",ref:a,style:{display:"none"},onChange:j}))});export{Ge as default};
